<!DOCTYPE html>
<html lang="fr">
<head>
  <meta charset="UTF-8">
  <title>Interface Jury</title>
  <script src="/socket.io/socket.io.js"></script>
</head>
<body>
  <h1>Proposer une enchère</h1>

  <p>Enchère actuelle : <strong id="currentBidDisplay">—</strong></p>

  <div id="controls">
    <button class="inc" data-inc="50">+50</button>
    <button class="inc" data-inc="125">+125</button>
    <button class="inc" data-inc="250">+250</button>
    <button class="inc" data-inc="500">+500</button>
  </div>    

  <script>
    const socket = io();
    const currentBidDisplay = document.getElementById("currentBidDisplay");
    const buttons = document.querySelectorAll("#controls .inc");

    let currentBid = null; // synchronisé via les évènements serveur

    const format = (n) => `${n} €`;

    const render = () => {
      currentBidDisplay.textContent = (currentBid === null || Number.isNaN(currentBid)) ? "—" : format(currentBid);
    };

    // Ecoute des mises à jour globales (acceptées par le serveur)
    socket.on("updateBid", (bid) => {
      const parsed = typeof bid === "number" ? bid : parseFloat(bid);
      if (!Number.isNaN(parsed)) {
        currentBid = parsed;
        render();
      }
    });

    // Envoi direct d'une nouvelle enchère en ajoutant l'incrément choisi
    const onClickInc = (evt) => {
      const inc = parseFloat(evt.currentTarget.getAttribute("data-inc"));
      const base = Number.isFinite(currentBid) ? currentBid : 0;
      const nextBid = base + inc;
      socket.emit("newBid", nextBid);
    };

    buttons.forEach((btn) => btn.addEventListener("click", onClickInc));

    socket.on("bidRejected", ({ reason }) => {
      alert(reason || "Enchère refusée");
    });

    // Rendu initial
    render();
  </script>
</body>
</html>
